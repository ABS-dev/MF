<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Algorithms for calculating MF from hierarchical data • MF</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Algorithms for calculating MF from hierarchical data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MF</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.4.11</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/QuickStartHierData.html">Quick Start when calculating MF from Hierarchical Data</a></li>
    <li><a class="dropdown-item" href="../articles/MFHierarchicalData.html">Algorithms for calculating MF from hierarchical data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ABS-dev/MF" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="MFHierarchicalData_files/kePrint-0.0.1/kePrint.js"></script><link href="MFHierarchicalData_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Algorithms for calculating MF from hierarchical data</h1>
                        <h4 data-toc-skip class="author">Center for
Veterinary Biologics - Statistics Section</h4>
            
            <h4 data-toc-skip class="date">August 2019</h4>
      

      <div class="d-none name"><code>MFHierarchicalData.rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 class="unnumbered" id="introduction">INTRODUCTION<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This document is intended to provide additional details regarding the
algorithms used for calculating mitigated fraction values for
hierarchical data as implemented in package <code>MF</code> via the
functions <code>MFClusHier</code>, <code>MFnest</code>,
<code>MFClusBootHier</code>, and <code>MFnestBoot</code>. A passing
familiarity is helpful in understanding the examples and underlying data
input in this guide. A quick start may be found at <a href="https://github.com/ABS-dev/MF/blob/master/inst/doc/QuickStartHierData.pdf" class="external-link">Quick
Start when calculating MF from Hierarchical Data</a>.</p>
<div class="section level3">
<h3 class="unnumbered" id="data-assumptions--nested-hierarchical-structure-">Data assumptions. Nested Hierarchical
structure.<a class="anchor" aria-label="anchor" href="#data-assumptions--nested-hierarchical-structure-"></a>
</h3>
<p>Examples in this document expect data to be structured in a
<em>nested hierarchical tree</em>, as shown in Table 1. If there are
only two variables (columns) or the experimental design is not nested,
then the methods described here may not apply. A nested design assumes
that the factor of one variable co-occur with another variable. For
example, Pen D exists only within Room Z. If the experimental design of
the data set is crossed (all factors of a variable co-occur with all
factors of another variable), it is not appropriate to use this guide as
written.</p>
<table class="table table table-bordered" style="font-size: 8px; width: auto !important; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
Nested hierarchical data structure.
</caption>
<thead><tr>
<th style="text-align:center;">
room
</th>
<th style="text-align:center;">
pen
</th>
<th style="text-align:center;">
litter
</th>
<th style="text-align:center;">
tx
</th>
<th style="text-align:center;">
lung
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:center;vertical-align: middle !important;" rowspan="24">
Room W
</td>
<td style="text-align:center;vertical-align: middle !important;" rowspan="8">
Pen A
</td>
<td style="text-align:center;vertical-align: middle !important;" rowspan="4">
Litter 11
</td>
<td style="text-align:center;vertical-align: middle !important;" rowspan="2">
vac
</td>
<td style="text-align:center;">
5.63
</td>
</tr>
<tr>
<td style="text-align:center;">
4.62
</td>
</tr>
<tr>
<td style="text-align:center;vertical-align: middle !important;" rowspan="2">
con
</td>
<td style="text-align:center;">
9.20
</td>
</tr>
<tr>
<td style="text-align:center;">
7.28
</td>
</tr>
<tr>
<td style="text-align:center;vertical-align: middle !important;" rowspan="4">
Litter 12
</td>
<td style="text-align:center;vertical-align: middle !important;" rowspan="2">
vac
</td>
<td style="text-align:center;">
3.76
</td>
</tr>
<tr>
<td style="text-align:center;">
3.86
</td>
</tr>
<tr>
<td style="text-align:center;vertical-align: middle !important;" rowspan="2">
con
</td>
<td style="text-align:center;">
6.31
</td>
</tr>
<tr>
<td style="text-align:center;">
3.52
</td>
</tr>
<tr>
<td style="text-align:center;vertical-align: middle !important;" rowspan="8">
Pen B
</td>
<td style="text-align:center;vertical-align: middle !important;" rowspan="4">
Litter 13
</td>
<td style="text-align:center;vertical-align: middle !important;" rowspan="2">
vac
</td>
<td style="text-align:center;">
4.36
</td>
</tr>
<tr>
<td style="text-align:center;">
6.10
</td>
</tr>
<tr>
<td style="text-align:center;vertical-align: middle !important;" rowspan="2">
con
</td>
<td style="text-align:center;">
7.87
</td>
</tr>
<tr>
<td style="text-align:center;">
8.34
</td>
</tr>
<tr>
<td style="text-align:center;vertical-align: middle !important;" rowspan="4">
Litter 14
</td>
<td style="text-align:center;vertical-align: middle !important;" rowspan="2">
vac
</td>
<td style="text-align:center;">
5.39
</td>
</tr>
<tr>
<td style="text-align:center;">
5.80
</td>
</tr>
<tr>
<td style="text-align:center;vertical-align: middle !important;" rowspan="2">
con
</td>
<td style="text-align:center;">
8.28
</td>
</tr>
<tr>
<td style="text-align:center;">
7.95
</td>
</tr>
<tr>
<td style="text-align:center;vertical-align: middle !important;" rowspan="8">
Pen C
</td>
<td style="text-align:center;vertical-align: middle !important;" rowspan="4">
Litter 15
</td>
<td style="text-align:center;vertical-align: middle !important;" rowspan="2">
vac
</td>
<td style="text-align:center;">
4.86
</td>
</tr>
<tr>
<td style="text-align:center;">
5.66
</td>
</tr>
<tr>
<td style="text-align:center;vertical-align: middle !important;" rowspan="2">
con
</td>
<td style="text-align:center;">
7.66
</td>
</tr>
<tr>
<td style="text-align:center;">
8.52
</td>
</tr>
<tr>
<td style="text-align:center;vertical-align: middle !important;" rowspan="4">
Litter 16
</td>
<td style="text-align:center;vertical-align: middle !important;" rowspan="2">
vac
</td>
<td style="text-align:center;">
4.17
</td>
</tr>
<tr>
<td style="text-align:center;">
4.84
</td>
</tr>
<tr>
<td style="text-align:center;vertical-align: middle !important;" rowspan="2">
con
</td>
<td style="text-align:center;">
5.82
</td>
</tr>
<tr>
<td style="text-align:center;">
7.72
</td>
</tr>
<tr>
<td style="text-align:center;vertical-align: middle !important;" rowspan="23">
Room Z
</td>
<td style="text-align:center;vertical-align: middle !important;" rowspan="8">
Pen D
</td>
<td style="text-align:center;vertical-align: middle !important;" rowspan="4">
Litter 17
</td>
<td style="text-align:center;vertical-align: middle !important;" rowspan="2">
vac
</td>
<td style="text-align:center;">
3.60
</td>
</tr>
<tr>
<td style="text-align:center;">
4.92
</td>
</tr>
<tr>
<td style="text-align:center;vertical-align: middle !important;" rowspan="2">
con
</td>
<td style="text-align:center;">
5.22
</td>
</tr>
<tr>
<td style="text-align:center;">
5.93
</td>
</tr>
<tr>
<td style="text-align:center;vertical-align: middle !important;" rowspan="4">
Litter 18
</td>
<td style="text-align:center;vertical-align: middle !important;" rowspan="2">
vac
</td>
<td style="text-align:center;">
7.62
</td>
</tr>
<tr>
<td style="text-align:center;">
5.04
</td>
</tr>
<tr>
<td style="text-align:center;vertical-align: middle !important;" rowspan="2">
con
</td>
<td style="text-align:center;">
8.62
</td>
</tr>
<tr>
<td style="text-align:center;">
6.27
</td>
</tr>
<tr>
<td style="text-align:center;vertical-align: middle !important;" rowspan="8">
Pen E
</td>
<td style="text-align:center;vertical-align: middle !important;" rowspan="4">
Litter 19
</td>
<td style="text-align:center;vertical-align: middle !important;" rowspan="2">
vac
</td>
<td style="text-align:center;">
3.79
</td>
</tr>
<tr>
<td style="text-align:center;">
5.38
</td>
</tr>
<tr>
<td style="text-align:center;vertical-align: middle !important;" rowspan="2">
con
</td>
<td style="text-align:center;">
9.45
</td>
</tr>
<tr>
<td style="text-align:center;">
6.51
</td>
</tr>
<tr>
<td style="text-align:center;vertical-align: middle !important;" rowspan="4">
Litter 20
</td>
<td style="text-align:center;vertical-align: middle !important;" rowspan="2">
vac
</td>
<td style="text-align:center;">
5.30
</td>
</tr>
<tr>
<td style="text-align:center;">
4.42
</td>
</tr>
<tr>
<td style="text-align:center;vertical-align: middle !important;" rowspan="2">
con
</td>
<td style="text-align:center;">
7.21
</td>
</tr>
<tr>
<td style="text-align:center;">
6.35
</td>
</tr>
<tr>
<td style="text-align:center;vertical-align: middle !important;" rowspan="7">
Pen F
</td>
<td style="text-align:center;vertical-align: middle !important;" rowspan="4">
Litter 21
</td>
<td style="text-align:center;vertical-align: middle !important;" rowspan="2">
vac
</td>
<td style="text-align:center;">
4.69
</td>
</tr>
<tr>
<td style="text-align:center;">
6.04
</td>
</tr>
<tr>
<td style="text-align:center;vertical-align: middle !important;" rowspan="2">
con
</td>
<td style="text-align:center;">
6.64
</td>
</tr>
<tr>
<td style="text-align:center;">
7.00
</td>
</tr>
<tr>
<td style="text-align:center;vertical-align: middle !important;" rowspan="3">
Litter 22
</td>
<td style="text-align:center;vertical-align: middle !important;" rowspan="2">
vac
</td>
<td style="text-align:center;">
4.90
</td>
</tr>
<tr>
<td style="text-align:center;">
5.37
</td>
</tr>
<tr>
<td style="text-align:center;">
con
</td>
<td style="text-align:center;">
6.77
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="determining-mitigated-fraction">DETERMINING MITIGATED FRACTION<a class="anchor" aria-label="anchor" href="#determining-mitigated-fraction"></a>
</h2>
<div class="section level3">
<h3 class="unnumbered" id="rank-tables-">Rank tables.<a class="anchor" aria-label="anchor" href="#rank-tables-"></a>
</h3>
<p>Deterimining the rank table is the first step of the algorithm. For
each <em>cluster</em>, the following values are determined:</p>
<ul>
<li>
<code>con_n</code> &amp; <code>vac_n</code>: Counts of observations
for each treatment (control or vaccinate) for a particular instance of a
unique factor level of a variable.</li>
<li>
<code>n1n2</code>: Product of counts, <code>con_n</code> *
<code>vac_n</code>.</li>
<li>
<code>w</code>: Wilcoxon statistic.</li>
<li>
<code>u</code>: Mann-Whitney statistic.</li>
<li>
<code>con_medResp</code> &amp; <code>vac_medResp</code>: Median
observation for each treatment (control or vaccinate) in a particular
instance of a unique factor level of a variable.</li>
</ul>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 12 × 10</span></span></span>
<span><span class="co">##    room   pen   litter    con_medResp con_n     w vac_medResp vac_n  n1n2     u</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> Room W Pen A Litter 11        8.24     2     7        5.12     2     4     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> Room W Pen A Litter 12        4.92     2     5        3.81     2     4     2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> Room W Pen B Litter 13        8.10     2     7        5.23     2     4     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> Room W Pen B Litter 14        8.12     2     7        5.60     2     4     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> Room W Pen C Litter 15        8.09     2     7        5.26     2     4     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> Room W Pen C Litter 16        6.77     2     7        4.50     2     4     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> Room Z Pen D Litter 17        5.57     2     7        4.26     2     4     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> Room Z Pen D Litter 18        7.44     2     6        6.33     2     4     3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> Room Z Pen E Litter 19        7.98     2     7        4.58     2     4     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> Room Z Pen E Litter 20        6.78     2     7        4.86     2     4     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">11</span> Room Z Pen F Litter 21        6.82     2     7        5.36     2     4     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">12</span> Room Z Pen F Litter 22        6.77     1     3        5.14     2     2     2</span></span></code></pre>
<p>A <em>cluster</em> refers to the full grouping designation of each
observation. For example, in Table 1 the cluster of the first
observation is Room W/Pen A/Litter 11, and there are four observations
within that cluster.</p>
<p>The values in the rank table is the same regardless of the variable
of interest. That is, whether a user is interested in the value of
mitigated fraction for variable “pen” or “litter” does not affect the
content of rows or columns, assuming the same input data.</p>
<div class="section level4">
<h4 class="unnumbered" id="using-package-mf-">Using package MF.<a class="anchor" aria-label="anchor" href="#using-package-mf-"></a>
</h4>
<p>Rank tables can be output with the following usage in package
<code>MF</code>:</p>
<ul>
<li>
<code>MFClusHier(...)$MFh</code>: Rank table field from
<code><a href="../reference/MFClusHier.html">MFClusHier()</a></code> output, calculated from input data.</li>
<li>
<code>MFh(...)</code>: Calculate just the rank table from input
data.</li>
<li>
<code>MFClusBootHier(...)$MFhBoot</code>: List which includes rank
table using bootstrapped input data as <code>...$bootmfh</code> and
calculated directly from inputdata as <code>...$mfh</code>.</li>
<li>
<code>MFhBoot(...)</code>: List which includes rank table using
bootstrapped input data as <code>...$bootmfh</code> and calculated
directly from inputdata as <code>...$mfh</code> without the additional
<code>...$MFnestBoot</code> output.</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 class="unnumbered" id="summarizing-the-rank-table-">Summarizing the rank table.<a class="anchor" aria-label="anchor" href="#summarizing-the-rank-table-"></a>
</h3>
<p>With a detailed rank table, it is possible to calculate the mitigated
fraction for a variety of variable choices. This is the second step of
the algorithm. For each variable of interest the following summations
are calculated for each level of that variable.</p>
<ul>
<li>
<code>N1N2</code>: Sum of the <code>n1n2</code> values from the rank
table for the factor level designated in the row.</li>
<li>
<code>U</code>: Sum of the <code>u</code> values from the rank table
for the factor level designated in the row.</li>
<li>
<code>con_N</code> &amp; <code>vac_N</code>: Sum of the counts from
the rank table matching the particular factor level designated in the
row.</li>
<li>
<code>con_medResp</code> &amp; <code>vac_medResp</code>: Median of
responses for each comparison group matching the particular factor level
of the row.</li>
<li>
<code>MF</code>: <span class="math inline">\(2 * U/N1N2 -
1\)</span>.</li>
</ul>
<p>The following example looks at the mitigated fraction of factors in
variable “pen”. We can see that the values for “N1N2” have been summed
from the previous rank table for all cases of “Pen A”, “Pen B”, etc.</p>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 9</span></span></span>
<span><span class="co">##   variable level    MF  N1N2     U con_N vac_N con_medResp vac_medResp</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> pen      Pen A  0.5      8     6     4     4        6.80        4.24</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> pen      Pen B  1        8     8     4     4        8.12        5.60</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> pen      Pen C  1        8     8     4     4        7.69        4.85</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> pen      Pen D  0.75     8     7     4     4        6.1         4.98</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> pen      Pen E  1        8     8     4     4        6.86        4.86</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> pen      Pen F  1        6     6     3     4        6.77        5.14</span></span></code></pre>
<p>It is possible to perform this summary without regard for variables
to get an overall mitigated fraction value.</p>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 9</span></span></span>
<span><span class="co">##   variable level    MF  N1N2     U con_N vac_N con_medResp vac_medResp</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> All      All   0.870    46    43    23    24        7.21        4.91</span></span></code></pre>
<div class="section level4">
<h4 class="unnumbered" id="using-package-mf--1">Using package MF.<a class="anchor" aria-label="anchor" href="#using-package-mf--1"></a>
</h4>
<ul>
<li>
<code>MFClusHier(...)</code>: calculates rank table and MF table as
a single step.</li>
<li>
<code>MFnest(...)</code>: calculates MF table from rank table.</li>
<li>
<code>MFClusBootHier(...)</code>: calculates rank table and MF table
as a single step, with bootstrapping.</li>
<li>
<code>MFnestBoot(...)</code>: calculates MF table including from
bootstrapped rank table.</li>
</ul>
</div>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="bootstrapping">BOOTSTRAPPING<a class="anchor" aria-label="anchor" href="#bootstrapping"></a>
</h2>
<p>Bootstrapping can occur in one of two points of consideration: at
<em>clusters</em> or at <em>units</em>.</p>
<div class="section level3">
<h3 class="unnumbered" id="resampling-clusters-">Resampling clusters.<a class="anchor" aria-label="anchor" href="#resampling-clusters-"></a>
</h3>
<p>In Table 1 the cluster of the first observation is Room W/Pen
A/Litter 11, and there are four observations within that cluster.
Bootstrapping clusters samples from the unique clusters with
replacement, so every instance will have the same number of clusters as
the original data, but they may not be unique. The example below shows
one possiblility of a bootstrap instance from the example data.</p>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 12 × 4</span></span></span>
<span><span class="co">##    bootID room   pen   litter   </span></span>
<span><span class="co">##     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>      1 Room W Pen A Litter 11</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>      1 Room W Pen A Litter 12</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>      1 Room W Pen C Litter 16</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>      1 Room W Pen C Litter 16</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>      1 Room Z Pen D Litter 17</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>      1 Room Z Pen E Litter 19</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>      1 Room Z Pen E Litter 19</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>      1 Room Z Pen E Litter 20</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>      1 Room Z Pen E Litter 20</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>      1 Room Z Pen E Litter 20</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">11</span>      1 Room Z Pen F Litter 21</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">12</span>      1 Room Z Pen F Litter 21</span></span></code></pre>
<p>During bootstrapping of clusters, the observations within that
cluster do not change composition. That is, Room W/Pen A/Litter 11
continues to have the same two vaccinates (5.63, 4.62) and the same two
controls (9.20, 7.28).</p>
</div>
<div class="section level3">
<h3 class="unnumbered" id="resampling-units-">Resampling units.<a class="anchor" aria-label="anchor" href="#resampling-units-"></a>
</h3>
<p>Bootstrapping the unit involves sampling with replacement the
observed values within a particular comparison group for that cluster.
The mix of control and vaccinate groups remains constant for a unique
cluster and determines the number of sampling events. For example, the
cluster Room W/Pen A/Litter 11 has 2 vaccinates and 2 controls.
Bootstrapping the unit involves sampling with replacement twice from the
observed response of samples in the selection Room W/Pen A/Litter 11/vac
and twice from the observed response of samples in the selection Room
W/Pen A/Litter 11/con for each instance of the cluster Room W/Pen
A/Litter 11. The number of times that a unique cluster exists in the
bootstrapped data is determined by sampling of the clusters (see above
discussion).</p>
<p>After bootstrapping at the unit level, a particular instance of the
cluster Room W/Pen A/Litter 11 will continue to contain two vaccinates
but the values may both be 5.63 while the two controls may have the
values (7.28, 9.20).</p>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="appendix">APPENDIX<a class="anchor" aria-label="anchor" href="#appendix"></a>
</h2>
<div class="section level3">
<h3 class="unnumbered" id="code-used-in-this-example">Code used in this example<a class="anchor" aria-label="anchor" href="#code-used-in-this-example"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  room <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Room"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"W"</span>, <span class="st">"Z"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">24</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  pen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Pen"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, each <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  litter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Litter"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">11</span><span class="op">:</span><span class="fl">22</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  tx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"vac"</span>, <span class="st">"con"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="fl">12</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">76153</span><span class="op">)</span></span>
<span><span class="va">a</span><span class="op">$</span><span class="va">lung</span><span class="op">[</span><span class="va">a</span><span class="op">$</span><span class="va">tx</span> <span class="op">==</span> <span class="st">"vac"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">24</span>, <span class="fl">5</span>, <span class="fl">1.3</span><span class="op">)</span></span>
<span><span class="va">a</span><span class="op">$</span><span class="va">lung</span><span class="op">[</span><span class="va">a</span><span class="op">$</span><span class="va">tx</span> <span class="op">==</span> <span class="st">"con"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">24</span>, <span class="fl">7</span>, <span class="fl">1.3</span><span class="op">)</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">[</span><span class="op">-</span><span class="fl">48</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># DETERMINING MITIGATED FRACTION</span></span>
<span><span class="va">thismfh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MFh.html">MFh</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">lung</span> <span class="op">~</span> <span class="va">tx</span> <span class="op">+</span> <span class="va">room</span> <span class="op">/</span> <span class="va">pen</span> <span class="op">/</span> <span class="va">litter</span>, data <span class="op">=</span> <span class="va">a</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/MFnest.html">MFnest</a></span><span class="op">(</span><span class="va">thismfh</span>, which.factor <span class="op">=</span> <span class="st">"pen"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/MFnest.html">MFnest</a></span><span class="op">(</span><span class="va">thismfh</span>, which.factor <span class="op">=</span> <span class="st">"All"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># BOOTSTRAPPING</span></span>
<span><span class="fu"><a href="../reference/MFClusBootHier.html">MFClusBootHier</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">lung</span> <span class="op">~</span> <span class="va">tx</span> <span class="op">+</span> <span class="va">room</span> <span class="op">/</span> <span class="va">pen</span> <span class="op">/</span> <span class="va">litter</span>,</span>
<span>               data <span class="op">=</span> <span class="va">a</span>, boot.unit <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>               boot.cluster <span class="op">=</span> <span class="cn">TRUE</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>               which.factor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"room"</span>, <span class="st">"litter"</span>, <span class="st">"All"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mfboot_multiple</span><span class="op">$</span><span class="va">MFhBoot</span><span class="op">$</span><span class="va">bootmfh</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">bootID</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bootID"</span>, <span class="st">"room"</span>, <span class="st">"pen"</span>, <span class="st">"litter"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 class="unnumbered" id="session-details-for-this-manual-">Session details for this manual.<a class="anchor" aria-label="anchor" href="#session-details-for-this-manual-"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.5.0 (2025-04-11 ucrt)</span></span>
<span><span class="co">## Platform: x86_64-w64-mingw32/x64</span></span>
<span><span class="co">## Running under: Windows 11 x64 (build 22631)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">##   LAPACK version 3.12.1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">## [1] LC_COLLATE=English_United States.utf8 </span></span>
<span><span class="co">## [2] LC_CTYPE=English_United States.utf8   </span></span>
<span><span class="co">## [3] LC_MONETARY=English_United States.utf8</span></span>
<span><span class="co">## [4] LC_NUMERIC=C                          </span></span>
<span><span class="co">## [5] LC_TIME=English_United States.utf8    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: America/Chicago</span></span>
<span><span class="co">## tzcode source: internal</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">##  [1] MF_4.4.11        lubridate_1.9.4  forcats_1.0.0    stringr_1.5.1   </span></span>
<span><span class="co">##  [5] dplyr_1.1.4      purrr_1.0.4      readr_2.1.5      tidyr_1.3.1     </span></span>
<span><span class="co">##  [9] tibble_3.3.0     ggplot2_3.5.2    tidyverse_2.0.0  kableExtra_1.4.0</span></span>
<span><span class="co">## [13] knitr_1.50      </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] utf8_1.2.6         sass_0.4.10        generics_0.1.4     xml2_1.3.8        </span></span>
<span><span class="co">##  [5] stringi_1.8.7      hms_1.1.3          digest_0.6.37      magrittr_2.0.3    </span></span>
<span><span class="co">##  [9] timechange_0.3.0   evaluate_1.0.4     grid_4.5.0         RColorBrewer_1.1-3</span></span>
<span><span class="co">## [13] fastmap_1.2.0      plyr_1.8.9         jsonlite_2.0.0     viridisLite_0.4.2 </span></span>
<span><span class="co">## [17] scales_1.4.0       textshaping_1.0.1  jquerylib_0.1.4    cli_3.6.5         </span></span>
<span><span class="co">## [21] rlang_1.1.6        withr_3.0.2        cachem_1.1.0       yaml_2.3.10       </span></span>
<span><span class="co">## [25] tools_4.5.0        tzdb_0.5.0         vctrs_0.6.5        R6_2.6.1          </span></span>
<span><span class="co">## [29] lifecycle_1.0.4    fs_1.6.6           htmlwidgets_1.6.4  ragg_1.4.0        </span></span>
<span><span class="co">## [33] pkgconfig_2.0.3    desc_1.4.3         pkgdown_2.1.3      pillar_1.10.2     </span></span>
<span><span class="co">## [37] bslib_0.9.0        gtable_0.3.6       Rcpp_1.1.0         glue_1.8.0        </span></span>
<span><span class="co">## [41] systemfonts_1.2.3  xfun_0.52          tidyselect_1.2.1   rstudioapi_0.17.1 </span></span>
<span><span class="co">## [45] dichromat_2.0-0.1  farver_2.1.2       htmltools_0.5.8.1  rmarkdown_2.29    </span></span>
<span><span class="co">## [49] svglite_2.2.1      compiler_4.5.0</span></span></code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by CVB Statistics, David Siev, Marie Vendettuoli, Thomas Kent.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
